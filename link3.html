<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags-->
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Color theme for statusbar (Android only) -->
    <meta name="theme-color" content="#2196f3">
    <!-- Your app title -->
    <title>Ana Lima Moda</title>
    <!-- Path to Framework7 Library Bundle CSS -->
    <link rel="stylesheet" href="lib/framework7-bundle.min.css">
    <!-- CSS PERSONALIZADO PARA MENU-->
    <link rel="stylesheet" href="css/index.css">
    <!--Ícones Material Design-->
    <link rel="stylesheet" href="css/materialdesignicons.min.css">
    <!--Ícones Material Design-->
    <link rel="stylesheet" href="css/remixicon.css">
    

</head>

<body>
    <!-- App root element -->
    <div id="app">
        <!-- Popup para adicionar cliente -->
        <div class="popup popup-cliente custom-popup-anim" id="popup-add-cliente">
          <div class="view">
            <div class="page">
              <div class="navbar">
                <div class="navbar-inner">
                  <div class="title">Novo Cliente</div>
                  <div class="right">
                    <a href="#" class="link popup-close icon-only">
                      <i class="ri-close-line"></i>
                    </a>
                  </div>                  
                </div>
              </div>
              <div class="page-content">
                <div class="block">
                  <div class="list no-hairlines-md">
                    <ul>
                      <li class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Nome do Cliente</div>
                          <div class="item-input-wrap">
                            <input type="text" id="input-nome-produto" placeholder="Digite o nome" />
                          </div>
                        </div>
                      </li>
                      <li class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Contato</div>
                          <div class="item-input-wrap input-contato-wrap">
                            <input type="text" id="input-contato-produto" placeholder="Contato" />
                          </div>
                        </div>
                      </li>
                      <li class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Tamanho</div>
                          <div class="item-input-wrap">
                            <input type="text" id="input-tamanho-produto" placeholder="Tamanho" />
                          </div>
                        </div>
                      </li>
                      <li class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title item-label">Valor da dívida</div>
                          <div class="item-input-wrap">
                            <input type="number" id="input-valor-gasto" placeholder="Ex: 25.50" step="0.01" />
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>
                  <div class="block">
                    <a href="#" class="button button-fill" id="btn-add-cliente">Adicionar</a>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Popup de Detalhes do Cliente -->
        <div class="popup" id="popup-detalhes-cliente">
          <div class="view">
            <div class="page">
              <div class="navbar">
                <div class="navbar-inner">
                  <div class="title">Detalhes do Cliente</div>
                  <div class="right">
                    <a href="#" class="link popup-close">
                      <i class="ri-close-line"></i>
                    </a>
                  </div>
                </div>
              </div>
              <div class="page-content">
                <div class="block">
                  <div id="detalhes-cliente-content">
                    <p>Carregando...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>


        <!-- Your main view, should have "view-main" class -->
        <div class="view view-main">

            <!-- TAB BAR-->
            <div class="toolbar toolbar-bottom">
                <div class="toolbar-inner display-flex">
                    <a href="/loadingindex/" class="tab-link link">
                        <i class="ri-t-shirt-line"></i>
                        <span>Estoque</span>
                    </a>
                    <a href="/loadinglink2/" class="tab-link link">
                        <i class="ri-arrow-left-right-line"></i>
                        <span>Entada/Saída</span>
                    </a>
                    <a href="/loadinglink3/" class="tab-link link active">
                        <i class="ri-user-line"></i>
                        <span>Clientes</span>
                    </a>
                    <a href="/loadinglink4/" class="tab-link link">
                        <i class="ri-align-justify"></i>
                        <span>Configurações</span>
                    </a>

                </div>
            </div>

            <!-- Initial Page, "data-name" contains page name -->
            <div data-name="link3" class="page color-theme-blue">

                

                <!-- Top Navbar -->
                <div class="navbar">
                    <div class="navbar-bg"></div>
                    <div class="navbar-inner">
                    
                    <!-- Botão de Adição à Esquerda -->
                    <div class="left">
                      <a href="#" class="link icon-only popup-open" data-popup="#popup-add-cliente">
                        <i class="ri-add-line"></i>
                      </a>
                      
                    </div>
                
                    <!-- Título Centralizado -->
                    <div class="title" id="app-title">Clientes</div>
                    
                    <!-- Campo de Busca -->
                    <form class="searchbar searchbar-init hidden" data-search-container=".card-list" data-search-in=".card-content">
                      <div class="searchbar-inner">
                        <div class="searchbar-input-wrap">
                          <input type="text" id="searchInput" class="search-box" placeholder="Buscar cliente...">
                          <i class="searchbar-icon"></i>
                          <span class="input-clear-button"></span>
                        </div>
                        <span class="searchbar-disable-button if-not-aurora">Cancelar</span>
                      </div>
                    </form>


                    <!-- Botão de Busca à Direita -->
                    <div class="right">
                      <a href="#" class="link icon-only" id="btnBuscar">
                        <i id="searchIcon" class="ri-search-line"></i>
                      </a>
                    </div>       
                    <!-- <button onclick="atualizarAbasClientes()">Atualizar abas</button> -->
 
                    </div>
                </div>
  

                <!-- Scrollable page content -->
                <div class="page-content ptr-content">
                    <div class="ptr-preloader">
                      <div class="preloader"></div>
                      <div class="ptr-arrow"></div>
                    </div>
                    
                    
                    <!-- Preloader -->
                    <div id="preloader" style=" text-align: center; margin: 50px 0;">
                      <div class="preloader"></div>
                    </div>
                    <div id="clientes" class="block grid grid-cols-1 gap-2 card-list" style="padding: 10px;"></div>

                    <!-- Botão flutuante para filtros -->
                    <div class="fab-container">
                      <button id="filterButton" class="filtro-icon">
                        <i class="ri-filter-line"></i> <!-- Ícone de filtro -->
                      </button>
                    </div>

                    <div class="popup custom-popup-anim" id="popup-filtros">
                      <div class="view">
                        <div class="page">
                          <div class="navbar">
                            <div class="navbar-inner">
                              <div class="title">Filtros</div>
                              <div class="right">
                                <a href="#" class="link popup-close"><i class="ri-close-line"></i></a>
                              </div>
                            </div>
                          </div>
                          <div class="page-content">
                            <div class="block">
                              <form id="filtrosForm">
                                <input type="checkbox" name="filtro" value="camiseta" id="chk-camiseta">
                                <label for="chk-camiseta">Camiseta</label><br>
                                <input type="checkbox" name="filtro" value="calca" id="chk-calca">
                                <label for="chk-calca">Calça</label><br>
                                <input type="checkbox" name="filtro" value="jaqueta" id="chk-jaqueta">
                                <label for="chk-jaqueta">Jaqueta</label><br>
                                <input type="checkbox" name="filtro" value="tam: gg" id="chk-gg">
                                <label for="chk-gg">Tam: GG</label><br>
                                <input type="checkbox" name="filtro" value="cor: branco" id="chk-branco">
                                <label for="chk-branco">Cor: Branco</label><br>
                              </form>
                              <br>
                              <button class="button button-fill" id="aplicarFiltrosBtn">Aplicar</button>
                              <button class="button button-outline color-red" id="limparFiltrosBtn">Limpar Filtros</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
            </div>
        </div>
    </div>
    <!-- Path to Framework7 Library Bundle JS-->
    <script type="text/javascript" src="lib/framework7-bundle.min.js"></script>
	  <!-- jQuery -->
	  <script type="text/javascript" src="lib/jquery-3.7.0.min.js"></script>	
    <script src="js/funcoes.js"></script>
    <!-- Roteamento do app-->
    <script type="text/javascript" src="js/routes.js"></script>
    <script src="cordova.js"></script>

    <script>
      app.ptr.done(); // usa o app já existente
  
      // Usar Dom7 (o "jQuery" do Framework7)
      var $$ = Dom7;
  
      // Evento quando o usuário puxa para atualizar
      $$('.ptr-content').on('ptr:refresh', function (e) {
          // Simula uma requisição de rede ou recarregamento
          setTimeout(function () {
              app.ptr.done(); // Finaliza o preload
              carregarProdutos3();
          });
      });
  
      var searchbar;
      var isSearchVisible = false;

      $$('#btnBuscar').on('click', function () {
        if (!searchbar) {
          searchbar = app.searchbar.create({
            el: '.searchbar',
            customSearch: true,
            on: {
              search: function (sb, query) {
                //console.log('Searchbar (via botão) digitou:', query); // DEBUG
                $$('.card').each(function () {
                  const text = $$(this).text().toLowerCase(); // <- Aqui pega o texto do card inteiro
                  if (text.includes(query.toLowerCase()) || query.trim() === '') {
                    $$(this).show();
                  } else {
                    $$(this).hide();
                  }
                });
              }
            }
          });
        }

        if (!isSearchVisible) {
          $$('.searchbar').removeClass('hidden');
          $$('#app-title').addClass('hidden'); // esconde o título
          $$('#searchIcon').removeClass('ri-search-line').addClass('ri-close-line');
          isSearchVisible = true;
          
          setTimeout(() => {
            $$('.searchbar input').focus();
          }, 200);
          
        } else {
          $$('.searchbar').addClass('hidden');
          $$('#searchIcon').removeClass('ri-close-line').addClass('ri-search-line');
          isSearchVisible = false;
          setTimeout(() => {
            $$('#searchInput').val('');
            $$('#app-title').removeClass('hidden'); // mostra o título de volta
          }, 200); // sincroniza com o tempo da animação da searchbar

          // exibe todos os cards novamente
          $$('.card').show();

        }
      });
      
      $$('#searchInput').on('input', function () {
        const query = $$(this).val().toLowerCase();
        //console.log('Digitado no campo de busca:', query); // DEBUG
        $$('.card').each(function () {
          const text = $$(this).text().toLowerCase(); // <- Aqui também
          if (text.includes(query) || query.trim() === '') {
            $$(this).show();
          } else {
            $$(this).hide();
          }
        });
      });

      $$('#btn-add-cliente').on('click', async function () {
      const nome = $$('#input-nome-produto').val().trim();
      const contato = $$('#input-contato-produto').val().trim();
      const valorGasto = $$('#input-valor-gasto').val().trim();
      const tamanho = $$('#input-tamanho-produto').val().trim();

      const modo = $$('#btn-add-cliente').data('modo') || 'adicionar';
      const nomeOriginal = $$('#btn-add-cliente').data('nomeOriginal') || nome;

      if (!nome) {
        app.dialog.alert('Por favor, preencha o nome do cliente.');
        return;
      }

      const dados = {
        nome,
        contato,
        valorGasto,
        tamanho,
        acao: modo,
        nomeOriginal
      };

      await fetch("", {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(dados)
      });

      // Limpar o modo para voltar ao normal
      $$('#btn-add-cliente').removeData('modo');
      $$('#btn-add-cliente').removeData('nomeOriginal');

      app.popup.close('#popup-add-cliente');
      $$('#input-nome-produto').val('');
      $$('#input-contato-produto').val('');
      $$('#input-valor-gasto').val('');
      $$('#input-tamanho-produto').val('');

      $$('#preloader').show();
      setTimeout(() => {
        carregarProdutos3();
      }, 2000);
    });




      // Abrir popup de filtros ao clicar no botão flutuante
      $$('#filterButton').on('click', function () {
        app.popup.open('#popup-filtros');
      });

      // Aplicar filtros selecionados
      $$('#aplicarFiltrosBtn').on('click', function () {
        const filtrosSelecionados = [];
        $$('#filtrosForm input[type="checkbox"]:checked').each(function () {
          filtrosSelecionados.push($$(this).val().toLowerCase());
        });

        //console.log('Filtros aplicados:', filtrosSelecionados); // debug

        $$('.card').each(function () {
          const card = $$(this);
          const textoCard = card.text().toLowerCase(); // pega todo o texto do card

          // Verifica se algum filtro bate com o texto do card
          const corresponde = filtrosSelecionados.some(filtro => textoCard.includes(filtro));

          if (corresponde || filtrosSelecionados.length === 0) {
            card.show();
          } else {
            card.hide();
          }
        });

        app.popup.close('#popup-filtros');
      });

      // Botão para limpar os filtros
      $$('#limparFiltrosBtn').on('click', function () {
        // Desmarca todos os checkboxes
        $$('#filtrosForm input[type="checkbox"]').prop('checked', false);

        // Mostra todos os cards novamente
        $$('.card').show();

        // Fecha o popup
        app.popup.close('#popup-filtros');
      });

      function abrirPopupEdicao(nome, contato, tamanho, valorGasto) {
        $$('#input-nome-produto').val(nome);
        $$('#input-contato-produto').val(contato);
        $$('#input-tamanho-produto').val(tamanho);
        $$('#input-valor-gasto').val(valorGasto);

        // Marcar que é edição
        $$('#btn-add-cliente').data('modo', 'editar');
        $$('#btn-add-cliente').data('nomeOriginal', nome);
        $$('#btn-add-cliente').text('Salvar alterações');

        app.popup.open('#popup-add-cliente');
      }

    </script>

    <script>

      document.addEventListener('DOMContentLoaded', function () {
        // Mostrar preloader inicialmente
        $$('#preloader').show();

        // Simula um delay (você pode remover o setTimeout depois se quiser)
        setTimeout(() => {
          carregarProdutos3(); // sua função que popula os clientes
          $$('#preloader').hide(); // Esconde o preloader depois do carregamento
        }, 2000); // tempo simulado para carregamento
      });

      // Esconde os cards ao sair da página link3
      $$(document).on('page:beforeout', '.page[data-name="link3"]', function () {
        console.log('Saindo da link3, ocultando cards');
        $$('#clientes').hide();
      });

      // Mostra os cards ao retornar para a página link3
      $$(document).on('page:afterin', '.page[data-name="link3"]', function () {
        console.log('Voltando para link3, mostrando cards');
        $$('#clientes').show();
      });
    </script>
  
</body>  

</html>