<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buscar CEP por Rua — ViaCEP</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:#222}
    body{margin:0;padding:24px;background:#f5f7fb}
    .container{max-width:900px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(20,30,50,0.08)}
    h1{margin:0 0 12px;font-size:20px}
    form{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px}
    input, select, button{padding:10px;border:1px solid #d6dbe8;border-radius:6px;font-size:14px}
    input[type="text"]{flex:1 1 320px}
    select{width:90px}
    button{background:#1e88e5;color:#fff;border:0;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .results{margin-top:12px}
    .card{padding:12px;border-radius:8px;border:1px solid #e6eefc;background:#fbfdff;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .addr{max-width:75%}
    .addr b{display:block}
    .meta{color:#4b5d7a;font-size:13px}
    .actions{display:flex;gap:8px}
    .copy-btn{background:#2e7d32;padding:8px 10px;border-radius:6px;color:#fff;border:0}
    .copy-btn:active{transform:translateY(1px)}
    .small{font-size:13px;color:#7a8597;margin-top:6px}
    .error{color:#b00020;background:#fff0f1;padding:10px;border-radius:6px}
    footer{margin-top:18px;font-size:13px;color:#6b7280}
    @media (max-width:560px){ .card{flex-direction:column;align-items:flex-start} .addr{max-width:100%}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Buscar CEP por Rua (ViaCEP)</h1>
    <form id="form">
      <select id="uf" aria-label="UF">
        <option value="SP">SP</option><option value="RJ">RJ</option><option value="MG">MG</option>
        <option value="BA">BA</option><option value="PR">PR</option><option value="RS">RS</option>
        <option value="SC">SC</option><option value="CE">CE</option><option value="PE">PE</option>
        <!-- adicione outras UFs conforme necessário -->
      </select>
      <input id="cidade" type="text" placeholder="Cidade (ex: São Paulo)" required />
      <input id="rua" type="text" placeholder="Rua / Logradouro (ex: Avenida Paulista)" required />
      <button id="buscar" type="submit">Buscar</button>
    </form>

    <div id="status" class="small"></div>
    <div id="results" class="results"></div>

    <footer>
      API usada: <a href="https://viacep.com.br" target="_blank" rel="noopener">ViaCEP</a> — sem necessidade de chave. A resposta pode conter vários CEPs para o logradouro.
    </footer>
  </div>

  <script>
    const form = document.getElementById('form');
    const ufEl = document.getElementById('uf');
    const cidadeEl = document.getElementById('cidade');
    const ruaEl = document.getElementById('rua');
    const buscarBtn = document.getElementById('buscar');
    const resultsEl = document.getElementById('results');
    const statusEl = document.getElementById('status');

    // Função reutilizável que retorna Promise com array de resultados (ou lança erro)
    async function getCepByAddress(uf, cidade, rua) {
      if (!uf || !cidade || !rua) throw new Error('uf, cidade e rua são necessários');
      const base = 'https://viacep.com.br/ws';
      const url = `${base}/${encodeURIComponent(uf)}/${encodeURIComponent(cidade)}/${encodeURIComponent(rua)}/json/`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Erro na requisição: ${res.status}`);
      const json = await res.json();
      // ViaCEP retorna {erro:true} em caso de erro ou array com resultados
      if (json.erro) return [];
      return Array.isArray(json) ? json : [];
    }

    // renderiza resultados
    function renderResults(list) {
      resultsEl.innerHTML = '';
      if (!list || list.length === 0) {
        statusEl.textContent = 'Nenhum CEP encontrado para a combinação informada.';
        return;
      }
      statusEl.textContent = `Encontrados ${list.length} resultado(s).`;

      list.forEach(item => {
        // item: { cep, logradouro, complemento, bairro, localidade, uf, ... }
        const card = document.createElement('div');
        card.className = 'card';

        const addr = document.createElement('div');
        addr.className = 'addr';
        const title = document.createElement('b');
        title.textContent = `${item.logradouro || '(sem logradouro)'} — ${item.bairro || ''}`;
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `${item.localidade || ''} - ${item.uf || ''}${item.complemento ? ' • ' + item.complemento : ''}`;

        const cepLine = document.createElement('div');
        cepLine.style.marginTop = '6px';
        cepLine.textContent = `CEP: ${item.cep || '—'}`;

        addr.appendChild(title);
        addr.appendChild(meta);
        addr.appendChild(cepLine);

        const actions = document.createElement('div');
        actions.className = 'actions';

        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.textContent = 'Copiar CEP';
        copyBtn.type = 'button';
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(item.cep || '');
            copyBtn.textContent = 'Copiado!';
            setTimeout(()=> copyBtn.textContent = 'Copiar CEP', 1200);
          } catch (e) {
            alert('Não foi possível copiar. CEP: ' + (item.cep || ''));
          }
        });

        // botao para inserir no formulário (exemplo de integração)
        const useBtn = document.createElement('button');
        useBtn.type = 'button';
        useBtn.textContent = 'Usar no formulário';
        useBtn.addEventListener('click', () => {
          // Você pode controlar aqui o que fazer com o CEP (ex.: preencher campo do seu app)
          // Ex.: document.querySelector('#cep').value = item.cep;
          alert('Integre aqui: preencha o campo CEP com: ' + item.cep);
        });

        actions.appendChild(copyBtn);
        actions.appendChild(useBtn);

        card.appendChild(addr);
        card.appendChild(actions);
        resultsEl.appendChild(card);
      });
    }

    // handler do form
    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      resultsEl.innerHTML = '';
      statusEl.textContent = '';
      buscarBtn.disabled = true;
      buscarBtn.textContent = 'Buscando...';

      const uf = ufEl.value.trim().toUpperCase();
      const cidade = cidadeEl.value.trim();
      const rua = ruaEl.value.trim();

      try {
        const list = await getCepByAddress(uf, cidade, rua);
        renderResults(list);
      } catch (err) {
        console.error(err);
        resultsEl.innerHTML = `<div class="error">Erro: ${err.message}</div>`;
        statusEl.textContent = '';
      } finally {
        buscarBtn.disabled = false;
        buscarBtn.textContent = 'Buscar';
      }
    });

    // EXEMPLO: como usar getCepByAddress no seu código para automação:
    // getCepByAddress('SP', 'São Paulo', 'Avenida Paulista').then(list => { console.log(list) });

  </script>
</body>
</html>
